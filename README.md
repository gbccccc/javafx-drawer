# javafx-drawer

## 引言

本项目基于 JavaFX 实现了一个简单的画图应用，核心功能包括图元绘制、删除、命名、移动、组合、复制粘贴，以及多步操作撤销和恢复。应用提供了清晰便捷的 GUI 界面，可以方便地使用键盘和鼠标操作。

![](./assets/app.png)

## 系统分析与设计

报告中的包名均省略相同的 `com.gbccccc.javafxdrawer.`

### 项目结构

本项目分为三个模块：`shape` 包包含多种简单图元类型（坐标无关，与画布低耦合），以及辅助图形操作的 `Point` 类和 `Translation` 类；`gui` 包中的类型会直接调用 JavaFX API，负责界面显示，其中 `DrawerController` 定义 GUI 交互逻辑，`gui.canvas` 包定义了图元显示类型（坐标有关，与画布强耦合并实现了在画布上绘制的方法）即它们的工厂；`log` 包定义了日志类型以实现操作撤销和恢复。

### 系统分析与实现

#### 图元绘制

本项目最复杂的逻辑在于图元的绘制，这个功能需要用户在滑板上选取若干个点用于创建新的图元，结束选取时机包含“用户手动结束选取”和“选取点数已达该图元上限”两个可能，结束后还需判断是否创建成功（即选取点数是否达到该图元下限），同时在鼠标移动时应实时显示图元的预览。

由于图元种类多、图元的创建过程长（用户需要多次选点）、已设定的参数会发生变化（鼠标移动），因此使用了结合了工厂模式和建造者模式的 `CanvasElementFactory` 类用于图元的创建。用户第一次点击画布时，工厂会根据选择的图元类型和点击位置创建一个最简单的图元显示类型对象；伴随用户的鼠标操作，工厂会维护一个点列表，其中最后一个点表示一个临时点，会根据鼠标移动而变化，每当此列表发生变化时，工厂会将此列表交给图元显示类型对象，让它自行处理选点列表；另外，图元工厂向上层提供了一个方法用于绘制正在创建的临时图元。

由于结束的时机和行为不统一，上层难以与用户交互的同时预判绘制的结束，因此上层需要使用观察者模式的回调机制获取完全创建完成的图元对象。`CanvasElementFactory` 维护了一个实现了 `ElementFactoryListener` 的对象的引用，而 `DrawerController` 实现了该接口：第一个方法在创建中的临时图元发生变化被调用，`DrawerController` 在此时重绘画布；第二个方法在图元创建结束且成功时被调用，`DrawerController` 在此时将新图元加入图元列表。

另外，`CanvasElementFactory` 使用了懒汉式的单例模式向 `CanvasElementFactory` 提供功能。
